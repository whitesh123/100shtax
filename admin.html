<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í• ì¼ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .circular-progress {
            transform: rotate(-90deg);
            filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.3));
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .share-modal.active {
            display: flex;
        }

        .share-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            z-index: 999;
            display: none;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .sync-status.syncing {
            display: flex;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }

        .sync-status.success {
            display: flex;
            background: linear-gradient(135deg, #10b981, #22c55e);
            color: white;
        }

        .sync-status.error {
            display: flex;
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 640px) {
            .share-modal-content {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem !important;
            }
            
            .text-5xl {
                font-size: 2rem !important;
            }
            
            .text-2xl {
                font-size: 1.5rem !important;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 p-4 sm:p-8">
    <div id="syncStatus" class="sync-status"></div>

    <div class="max-w-5xl mx-auto">
        <div class="text-center mb-6 sm:mb-8 animate-fade-in">
            <div class="inline-block bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-transparent bg-clip-text">
                <h1 class="text-3xl sm:text-5xl font-bold mb-2">âœ¨ í• ì¼ ê´€ë¦¬</h1>
            </div>
            <p class="text-gray-600 text-xs sm:text-sm">ë‹¹ì‹ ì˜ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”</p>
        </div>

        <div class="glass-effect rounded-3xl shadow-2xl p-4 sm:p-8 mb-6 animate-fade-in">
            <div class="mb-6 sm:mb-10 p-4 sm:p-8 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-2xl text-white shadow-xl">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div class="text-center sm:text-left">
                        <h2 class="text-xl sm:text-2xl font-bold mb-2 sm:mb-3">ì „ì²´ ì§„ì²™ë„</h2>
                        <p class="text-sm sm:text-lg opacity-90" id="totalProgressText">0ê°œì˜ í• ì¼ ì¤‘ 0ê°œ ì™„ë£Œ</p>
                    </div>
                    <div id="totalProgressCircle" class="transform hover:scale-110 transition-transform"></div>
                </div>
            </div>

            <div class="mb-6 sm:mb-8">
                <button id="archiveToggle" class="w-full sm:w-auto flex items-center justify-center gap-3 px-4 sm:px-6 py-3 rounded-xl transition font-medium shadow-lg bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 hover:from-purple-200 hover:to-pink-200 transform hover:scale-105">
                    <span class="text-xl">ğŸ“¦</span>
                    <span class="text-sm sm:text-base">ê³¼ê±° ì™„ë£Œì‘ì—… ë³´ê¸° (<span id="archiveCount">0</span>)</span>
                </button>
            </div>

            <div id="archiveSection" class="mb-6 sm:mb-8 p-4 sm:p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl hidden border-2 border-purple-200">
                <h3 class="text-lg sm:text-xl font-bold text-purple-800 mb-4 flex items-center gap-2">
                    <span>ğŸ“¦</span> ê³¼ê±° ì™„ë£Œì‘ì—…
                </h3>
                <div id="archiveList"></div>
            </div>

            <div class="mb-6 sm:mb-10 space-y-4 sm:space-y-5 p-4 sm:p-6 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl">
                <input type="text" id="titleInput" placeholder="âœï¸ í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" 
                    class="w-full px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition text-base sm:text-lg font-medium">
                
                <div>
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-2 sm:mb-3 ml-1">ğŸ“… ì‹œì‘ì¼ì‹œ (ì„ íƒ)</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                        <input type="date" id="dateInput" 
                            class="px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition text-sm sm:text-base">
                        <select id="timeHourInput" 
                            class="px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition text-sm sm:text-base">
                            <option value="">ì‹œê°„</option>
                        </select>
                        <select id="timeMinuteInput" 
                            class="px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition text-sm sm:text-base">
                            <option value="">ë¶„</option>
                            <option value="00">00ë¶„</option>
                            <option value="15">15ë¶„</option>
                            <option value="30">30ë¶„</option>
                            <option value="45">45ë¶„</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-2 sm:mb-3 ml-1">â° ì™„ë£Œì‹œí•œ (ì„ íƒ)</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                        <input type="date" id="deadlineInput" 
                            class="px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-100 transition text-sm sm:text-base">
                        <select id="deadlineHourInput" 
                            class="px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-100 transition text-sm sm:text-base">
                            <option value="">ì‹œê°„</option>
                        </select>
                        <select id="deadlineMinuteInput" 
                            class="px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-100 transition text-sm sm:text-base">
                            <option value="">ë¶„</option>
                            <option value="00">00ë¶„</option>
                            <option value="15">15ë¶„</option>
                            <option value="30">30ë¶„</option>
                            <option value="45">45ë¶„</option>
                        </select>
                    </div>
                </div>

                <button id="addBtn" 
                    class="w-full px-6 py-4 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white rounded-xl shadow-lg hover:shadow-xl transition transform hover:scale-105 font-bold text-base sm:text-lg">
                    â• ì¶”ê°€í•˜ê¸°
                </button>
            </div>

            <div id="todoList" class="space-y-4"></div>
        </div>
    </div>

    <!-- ê³ ê°ìš© ê³µìœ  ëª¨ë‹¬ -->
    <div id="shareModal" class="share-modal">
        <div class="share-modal-content">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ”—</span> ê³ ê°ê³¼ ê³µìœ 
            </h3>
            <p class="text-xs sm:text-sm text-gray-600 mb-6">ê³ ê°ì´ ì§„ì²™ë„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë§í¬ì…ë‹ˆë‹¤ (ì½ê¸° ì „ìš©)</p>
            <div class="mb-4">
                <input type="text" id="shareLink" readonly 
                    class="w-full px-4 py-3 border-2 border-indigo-200 rounded-lg bg-indigo-50 font-mono text-xs sm:text-sm">
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
                <button id="copyBtn" 
                    class="flex-1 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg transition transform hover:scale-105">
                    ğŸ“‹ ë§í¬ ë³µì‚¬
                </button>
                <button id="closeShareModal" 
                    class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition">
                    ë‹«ê¸°
                </button>
            </div>
            <p id="copyMessage" class="text-green-600 text-center mt-4 font-semibold hidden">âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
        </div>
    </div>

    <!-- íŒ€ì›ìš© ê³µìœ  ëª¨ë‹¬ -->
    <div id="teamShareModal" class="share-modal">
        <div class="share-modal-content">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ‘¥</span> íŒ€ì›ê³¼ ê³µìœ 
            </h3>
            <p class="text-xs sm:text-sm text-gray-600 mb-6">íŒ€ì›ì´ ì§„ì²™ë„ë¥¼ í™•ì¸í•˜ê³  ì²´í¬ë°•ìŠ¤ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ë§í¬ì…ë‹ˆë‹¤</p>
            <div class="mb-4">
                <input type="text" id="teamShareLink" readonly 
                    class="w-full px-4 py-3 border-2 border-indigo-200 rounded-lg bg-indigo-50 font-mono text-xs sm:text-sm">
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
                <button id="copyTeamBtn" 
                    class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:shadow-lg transition transform hover:scale-105">
                    ğŸ“‹ ë§í¬ ë³µì‚¬
                </button>
                <button id="closeTeamShareModal" 
                    class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition">
                    ë‹«ê¸°
                </button>
            </div>
            <p id="teamCopyMessage" class="text-green-600 text-center mt-4 font-semibold hidden">âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
        </div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzH7yaKhcRl_RNd74QJzG4MaWyvZSBPRXiHoNjht3lPCYaIjxvJ8arIr9ENNeobw8CB_Q/exec';
        
        let todos = [];
        let editingTodoId = null;
        let showArchive = false;

        // ì‹œê°„ ì„ íƒ ì´ˆê¸°í™”
        function initTimeSelectors() {
            const hourSelects = [document.getElementById('timeHourInput'), document.getElementById('deadlineHourInput')];
            hourSelects.forEach(select => {
                for (let i = 0; i < 24; i++) {
                    const option = document.createElement('option');
                    option.value = String(i).padStart(2, '0');
                    option.textContent = `${String(i).padStart(2, '0')}ì‹œ`;
                    select.appendChild(option);
                }
            });
        }

        initTimeSelectors();

        function showSyncStatus(type, message) {
            const status = document.getElementById('syncStatus');
            status.className = 'sync-status ' + type;
            status.textContent = message;
            setTimeout(() => {
                status.className = 'sync-status';
            }, 3000);
        }

        async function loadFromGoogleSheets() {
            try {
                showSyncStatus('syncing', 'ğŸ“¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                const response = await fetch(APPS_SCRIPT_URL);
                const data = await response.json();
                
                let needsUpdate = false;
                if (data && Array.isArray(data)) {
                    todos = data.map(t => {
                        // teamShareIdê°€ ì—†ëŠ” ê²½ìš° ìë™ ìƒì„±
                        if (!t.teamShareId) {
                            t.teamShareId = generateShareId();
                            needsUpdate = true;
                        }
                        // shareIdê°€ ì—†ëŠ” ê²½ìš°ë„ ìë™ ìƒì„±
                        if (!t.shareId) {
                            t.shareId = generateShareId();
                            needsUpdate = true;
                        }
                        return {
                            ...t,
                            subtasks: t.subtasks || []
                        };
                    });
                    showSyncStatus('success', 'âœ… ë™ê¸°í™” ì™„ë£Œ!');
                    
                    // ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ê²½ìš° ìë™ ì €ì¥
                    if (needsUpdate) {
                        await saveToGoogleSheets();
                    }
                } else {
                    todos = [];
                }
                render();
            } catch (error) {
                console.error('Load error:', error);
                showSyncStatus('error', 'âŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
            }
        }

        async function saveToGoogleSheets() {
            try {
                showSyncStatus('syncing', 'â˜ï¸ ì €ì¥ ì¤‘...');
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(todos)
                });
                showSyncStatus('success', 'âœ… ì €ì¥ ì™„ë£Œ!');
            } catch (error) {
                console.error('Save error:', error);
                showSyncStatus('error', 'âŒ ì €ì¥ ì‹¤íŒ¨');
            }
        }

        function generateShareId() {
            return 'share_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function addTodo() {
            const title = document.getElementById('titleInput').value.trim();
            if (!title) {
                alert('í• ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const date = document.getElementById('dateInput').value;
            const hourInput = document.getElementById('timeHourInput').value;
            const minuteInput = document.getElementById('timeMinuteInput').value;
            const time = (hourInput && minuteInput) ? `${hourInput}:${minuteInput}` : '';
            
            const deadline = document.getElementById('deadlineInput').value;
            const deadlineHour = document.getElementById('deadlineHourInput').value;
            const deadlineMinute = document.getElementById('deadlineMinuteInput').value;
            const deadlineTime = (deadlineHour && deadlineMinute) ? `${deadlineHour}:${deadlineMinute}` : '';

            const newTodo = {
                id: Date.now(),
                title: title,
                completed: false,
                subtasks: [],
                date: date || null,
                time: time || null,
                deadline: deadline || null,
                deadlineTime: deadlineTime || null,
                shareId: generateShareId(),
                teamShareId: generateShareId(),
                archived: false
            };

            todos.push(newTodo);
            
            document.getElementById('titleInput').value = '';
            document.getElementById('dateInput').value = '';
            document.getElementById('timeHourInput').value = '';
            document.getElementById('timeMinuteInput').value = '';
            document.getElementById('deadlineInput').value = '';
            document.getElementById('deadlineHourInput').value = '';
            document.getElementById('deadlineMinuteInput').value = '';

            saveToGoogleSheets();
            render();
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            todo.completed = !todo.completed;
            if (todo.subtasks) {
                todo.subtasks.forEach(st => st.completed = todo.completed);
            }
            
            saveToGoogleSheets();
            render();
        }

        function deleteTodo(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todos = todos.filter(t => t.id !== id);
                saveToGoogleSheets();
                render();
            }
        }

        function duplicateTodo(id) {
            const original = todos.find(t => t.id === id);
            if (!original) return;
            
            const duplicate = {
                ...original,
                id: Date.now(),
                title: original.title + ' (ë³µì‚¬ë³¸)',
                completed: false,
                shareId: generateShareId(),
                teamShareId: generateShareId(),
                subtasks: original.subtasks.map(st => ({...st, id: Date.now() + Math.random(), completed: false})),
                archived: false
            };
            
            todos.push(duplicate);
            saveToGoogleSheets();
            render();
        }

        function archiveTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            todo.archived = true;
            saveToGoogleSheets();
            render();
        }

        function unarchiveTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            todo.archived = false;
            saveToGoogleSheets();
            render();
        }

        function toggleExpand(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            todo.expanded = !todo.expanded;
            render();
        }

        function addSubtask(todoId, input) {
            const title = input.value.trim();
            if (!title) return;
            
            const todo = todos.find(t => t.id === todoId);
            if (!todo) return;
            
            if (!todo.subtasks) todo.subtasks = [];
            todo.subtasks.push({
                id: Date.now(),
                title: title,
                completed: false
            });
            
            input.value = '';
            saveToGoogleSheets();
            render();
        }

        function toggleSubtask(todoId, subtaskId) {
            const todo = todos.find(t => t.id === todoId);
            if (!todo) return;
            
            const subtask = todo.subtasks.find(st => st.id === subtaskId);
            if (!subtask) return;
            
            subtask.completed = !subtask.completed;
            
            if (todo.subtasks.every(st => st.completed)) {
                todo.completed = true;
            } else {
                todo.completed = false;
            }
            
            saveToGoogleSheets();
            render();
        }

        function deleteSubtask(todoId, subtaskId) {
            const todo = todos.find(t => t.id === todoId);
            if (!todo) return;
            
            todo.subtasks = todo.subtasks.filter(st => st.id !== subtaskId);
            saveToGoogleSheets();
            render();
        }

        function startEditTitle(id) {
            editingTodoId = id;
            render();
        }

        function saveEditTitle(id, input) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            const newTitle = input.value.trim();
            if (newTitle) {
                todo.title = newTitle;
                saveToGoogleSheets();
            }
            editingTodoId = null;
            render();
        }

        function cancelEditTitle() {
            editingTodoId = null;
            render();
        }

        function openShareModal(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            // í˜„ì¬ URLì˜ ë””ë ‰í† ë¦¬ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
            const currentUrl = window.location.href;
            const lastSlashIndex = currentUrl.lastIndexOf('/');
            const baseUrl = currentUrl.substring(0, lastSlashIndex + 1);
            const shareUrl = `${baseUrl}share-todo.html?id=${todo.shareId}`;
            
            document.getElementById('shareLink').value = shareUrl;
            document.getElementById('shareModal').classList.add('active');
        }

        function openTeamShareModal(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            // í˜„ì¬ URLì˜ ë””ë ‰í† ë¦¬ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
            const currentUrl = window.location.href;
            const lastSlashIndex = currentUrl.lastIndexOf('/');
            const baseUrl = currentUrl.substring(0, lastSlashIndex + 1);
            const shareUrl = `${baseUrl}team-share.html?id=${todo.teamShareId}`;
            
            document.getElementById('teamShareLink').value = shareUrl;
            document.getElementById('teamShareModal').classList.add('active');
        }

        function addToCalendar(todo) {
            let startDate = '';
            let endDate = '';
            
            if (todo.date) {
                startDate = todo.date.replace(/-/g, '') + (todo.time ? 'T' + todo.time.replace(':', '') + '00' : '');
            }
            
            if (todo.deadline) {
                endDate = todo.deadline.replace(/-/g, '') + (todo.deadlineTime ? 'T' + todo.deadlineTime.replace(':', '') + '00' : '');
            }
            
            const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(todo.title)}&dates=${startDate}/${endDate}`;
            window.open(calendarUrl, '_blank');
        }

        function getProgress(todo) {
            if (!todo || !todo.subtasks) return 0;
            if (todo.subtasks.length === 0) {
                return todo.completed ? 100 : 0;
            }
            const completed = todo.subtasks.filter(st => st.completed).length;
            return Math.round((completed / todo.subtasks.length) * 100);
        }

        function createCircularProgress(percentage, size = 100) {
            const radius = (size - 16) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            
            let gradientId = `gradient-${Math.random().toString(36).substr(2, 9)}`;
            let color1, color2;
            
            if (percentage < 30) {
                color1 = '#ef4444'; color2 = '#f97316';
            } else if (percentage < 70) {
                color1 = '#f59e0b'; color2 = '#eab308';
            } else if (percentage < 100) {
                color1 = '#22c55e'; color2 = '#10b981';
            } else {
                color1 = '#8b5cf6'; color2 = '#ec4899';
            }

            return `
                <div class="relative" style="width: ${size}px; height: ${size}px;">
                    <svg width="${size}" height="${size}" class="circular-progress">
                        <defs>
                            <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:${color1};stop-opacity:1" />
                                <stop offset="100%" style="stop-color:${color2};stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle cx="${size/2}" cy="${size/2}" r="${radius}" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                        <circle cx="${size/2}" cy="${size/2}" r="${radius}" fill="none" stroke="url(#${gradientId})" stroke-width="8" 
                            stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" stroke-linecap="round" 
                            style="transition: stroke-dashoffset 0.8s ease-in-out;"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-2xl sm:text-3xl font-bold bg-gradient-to-br from-indigo-600 to-purple-600 text-transparent bg-clip-text">${percentage}%</span>
                    </div>
                </div>
            `;
        }

        function render() {
            const activeTodos = todos.filter(t => !t.archived);
            const archivedTodos = todos.filter(t => t.archived);
            
            const totalTodos = activeTodos.length;
            const completedTodos = activeTodos.filter(t => t.completed).length;
            const totalProgress = totalTodos > 0 ? Math.round((completedTodos / totalTodos) * 100) : 0;
            
            document.getElementById('totalProgressText').textContent = `${totalTodos}ê°œì˜ í• ì¼ ì¤‘ ${completedTodos}ê°œ ì™„ë£Œ`;
            document.getElementById('totalProgressCircle').innerHTML = createCircularProgress(totalProgress, 100);
            
            document.getElementById('archiveCount').textContent = archivedTodos.length;
            
            if (archivedTodos.length > 0 && showArchive) {
                document.getElementById('archiveList').innerHTML = archivedTodos.map(todo => {
                    const progress = getProgress(todo);
                    return `
                        <div class="bg-white rounded-xl shadow-md p-4 mb-3">
                            <div class="flex items-center justify-between gap-3">
                                <p class="flex-1 font-semibold text-gray-600 line-through text-sm sm:text-base">${todo.title}</p>
                                <button onclick="unarchiveTodo(${todo.id})" 
                                    class="px-3 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-xs sm:text-sm font-medium">
                                    ë³µì›
                                </button>
                                <button onclick="deleteTodo(${todo.id})" 
                                    class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            if (activeTodos.length === 0) {
                document.getElementById('todoList').innerHTML = `
                    <div class="text-center py-16 text-gray-400">
                        <p class="text-4xl mb-4">ğŸ“</p>
                        <p class="text-lg font-medium">ì•„ì§ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p class="text-sm">ìœ„ì—ì„œ ìƒˆë¡œìš´ í• ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
            } else {
                document.getElementById('todoList').innerHTML = activeTodos.map(todo => {
                    const progress = getProgress(todo);
                    const isExpanded = todo.expanded;
                    const isOverdue = todo.deadline && new Date(todo.deadline + 'T' + (todo.deadlineTime || '23:59')) < new Date() && !todo.completed;
                    
                    return `
                        <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition overflow-hidden border-2 ${
                            todo.completed ? 'border-green-400 bg-gradient-to-br from-green-50 to-emerald-50' : 
                            isOverdue ? 'border-red-400 bg-gradient-to-br from-red-50 to-orange-50' : 
                            'border-indigo-200'
                        }">
                            <div class="p-4 sm:p-5">
                                <div class="flex items-start gap-3 sm:gap-4">
                                    <button onclick="toggleTodo(${todo.id})" 
                                        class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 rounded-xl border-2 flex items-center justify-center transition transform hover:scale-110 ${
                                            todo.completed ? 'bg-gradient-to-br from-indigo-400 to-purple-500 border-indigo-500' : 'border-gray-300 hover:border-indigo-500 bg-white'
                                        }">
                                        ${todo.completed ? '<span class="text-white text-base sm:text-lg font-bold">âœ“</span>' : ''}
                                    </button>

                                    <div class="flex-1 min-w-0">
                                        ${editingTodoId === todo.id ? `
                                            <input type="text" value="${todo.title}" 
                                                onkeypress="if(event.key==='Enter') { saveEditTitle(${todo.id}, this); }"
                                                onblur="cancelEditTitle()"
                                                class="w-full px-3 py-2 text-base sm:text-lg font-semibold border-2 border-indigo-500 rounded-lg focus:outline-none focus:ring-4 focus:ring-indigo-100"
                                                autofocus>
                                        ` : `
                                            <p class="font-semibold text-base sm:text-lg break-words ${todo.completed ? 'line-through text-gray-400' : 'text-gray-800'}" 
                                                ondblclick="startEditTitle(${todo.id})">
                                                ${todo.title}
                                            </p>
                                        `}
                                        <div class="text-xs sm:text-sm text-gray-600 mt-2 space-y-1 font-medium">
                                            ${(todo.date || todo.time) ? `
                                                <p class="flex items-center gap-2 flex-wrap">
                                                    <span class="text-base sm:text-lg">ğŸ“…</span>
                                                    <span class="break-all">ì‹œì‘: ${todo.date ? new Date(todo.date + 'T00:00').toLocaleDateString('ko-KR', {month: 'long', day: 'numeric'}) : ''} ${todo.time || ''}</span>
                                                </p>
                                            ` : ''}
                                            ${todo.deadline ? `
                                                <p class="flex items-center gap-2 flex-wrap ${isOverdue ? 'text-red-600 font-bold' : ''}">
                                                    <span class="text-base sm:text-lg">â°</span>
                                                    <span class="break-all">ì™„ë£Œì‹œí•œ: ${new Date(todo.deadline + 'T00:00').toLocaleDateString('ko-KR', {month: 'long', day: 'numeric'})} ${todo.deadlineTime || ''} ${isOverdue ? '(ê¸°í•œ ì´ˆê³¼!)' : ''}</span>
                                                </p>
                                            ` : ''}
                                        </div>
                                    </div>

                                    <div class="transform hover:scale-110 transition-transform flex-shrink-0">
                                        ${createCircularProgress(progress, 60)}
                                    </div>
                                </div>

                                <div class="mt-4 flex flex-wrap gap-2">
                                    <button onclick="openShareModal(${todo.id})" 
                                        class="px-3 py-2 text-xs sm:text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition font-medium" title="ê³ ê°ê³¼ ê³µìœ ">
                                        ğŸ”— ê³ ê°ê³µìœ 
                                    </button>
                                    <button onclick="openTeamShareModal(${todo.id})" 
                                        class="px-3 py-2 text-xs sm:text-sm bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition font-medium" title="íŒ€ì›ê³¼ ê³µìœ ">
                                        ğŸ‘¥ íŒ€ì›ê³µìœ 
                                    </button>
                                    <button onclick="duplicateTodo(${todo.id})" 
                                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition transform hover:scale-110" title="ë³µì‚¬í•˜ê¸°">
                                        ğŸ“‹
                                    </button>
                                    ${progress === 100 ? `
                                        <button onclick="archiveTodo(${todo.id})" 
                                            class="p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition transform hover:scale-110" title="ë³´ê´€í•˜ê¸°">
                                            ğŸ“¦
                                        </button>
                                    ` : ''}
                                    ${(todo.date || todo.deadline) ? `
                                        <button onclick='addToCalendar(${JSON.stringify(todo).replace(/'/g, "&apos;")})' 
                                            class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition transform hover:scale-110" title="ìº˜ë¦°ë”ì— ì¶”ê°€">
                                            ğŸ“…
                                        </button>
                                    ` : ''}
                                    <button onclick="deleteTodo(${todo.id})" 
                                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition transform hover:scale-110" title="ì‚­ì œ">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>

                                <button onclick="toggleExpand(${todo.id})" 
                                    class="w-full mt-4 py-2 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg transition font-medium">
                                    ${isExpanded ? 'â–² ì ‘ê¸°' : todo.subtasks && todo.subtasks.length > 0 ? 'â–¼ ì„¸ë¶€ëª©ë¡ ë³´ê¸°' : 'â• ì„¸ë¶€ì‘ì—… ì¶”ê°€'}
                                </button>
                            </div>

                            ${isExpanded ? `
                                <div class="px-4 sm:px-5 pb-4 sm:pb-5 bg-gradient-to-br from-indigo-50 to-purple-50 border-t-2 border-indigo-200">
                                    <div class="pt-4 space-y-3">
                                        ${todo.subtasks && todo.subtasks.length > 0 ? todo.subtasks.map(subtask => `
                                            <div class="flex items-center gap-3 p-2 bg-white rounded-lg shadow-sm hover:shadow-md transition">
                                                <button onclick="toggleSubtask(${todo.id}, ${subtask.id})" 
                                                    class="flex-shrink-0 w-5 h-5 sm:w-6 sm:h-6 rounded-md border-2 flex items-center justify-center transition transform hover:scale-110 ${
                                                        subtask.completed ? 'bg-gradient-to-br from-indigo-400 to-purple-500 border-indigo-500' : 'border-gray-300 hover:border-indigo-500 bg-white'
                                                    }">
                                                    ${subtask.completed ? '<span class="text-white text-xs font-bold">âœ“</span>' : ''}
                                                </button>
                                                <p class="flex-1 font-medium text-sm sm:text-base break-words ${subtask.completed ? 'line-through text-gray-400' : 'text-gray-700'}">
                                                    ${subtask.title}
                                                </p>
                                                <button onclick="deleteSubtask(${todo.id}, ${subtask.id})" 
                                                    class="p-1 text-red-400 hover:text-red-600 transition transform hover:scale-125 flex-shrink-0">
                                                    ğŸ—‘ï¸
                                                </button>
                                            </div>
                                        `).join('') : '<p class="text-center text-gray-400 py-4">ì•„ì§ ì„¸ë¶€ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                                        <div class="mt-4">
                                            <input type="text" placeholder="âœ¨ ì„¸ë¶€ ëª©ë¡ ì¶”ê°€..." 
                                                onkeypress="if(event.key==='Enter') { addSubtask(${todo.id}, this); }"
                                                class="w-full px-4 py-3 font-medium border-2 border-indigo-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition text-sm sm:text-base">
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
        }

        document.getElementById('addBtn').addEventListener('click', addTodo);
        document.getElementById('titleInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTodo();
        });

        document.getElementById('archiveToggle').addEventListener('click', () => {
            showArchive = !showArchive;
            const section = document.getElementById('archiveSection');
            const btn = document.getElementById('archiveToggle');
            
            if (showArchive) {
                section.classList.remove('hidden');
                btn.classList.remove('bg-gradient-to-r', 'from-purple-100', 'to-pink-100', 'text-purple-700');
                btn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'text-white');
                btn.innerHTML = '<span class="text-xl">ğŸ“¦</span> <span class="text-sm sm:text-base">ê³¼ê±° ì™„ë£Œì‘ì—… ë‹«ê¸° (<span id="archiveCount">' + 
                    todos.filter(t => t.archived).length + '</span>)</span>';
            } else {
                section.classList.add('hidden');
                btn.classList.add('bg-gradient-to-r', 'from-purple-100', 'to-pink-100', 'text-purple-700');
                btn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'text-white');
                btn.innerHTML = '<span class="text-xl">ğŸ“¦</span> <span class="text-sm sm:text-base">ê³¼ê±° ì™„ë£Œì‘ì—… ë³´ê¸° (<span id="archiveCount">' + 
                    todos.filter(t => t.archived).length + '</span>)</span>';
            }
        });

        // ê³ ê° ê³µìœ  ëª¨ë‹¬
        document.getElementById('closeShareModal').addEventListener('click', () => {
            document.getElementById('shareModal').classList.remove('active');
        });

        document.getElementById('copyBtn').addEventListener('click', async () => {
            const link = document.getElementById('shareLink').value;
            try {
                await navigator.clipboard.writeText(link);
                document.getElementById('copyMessage').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('copyMessage').classList.add('hidden');
                }, 3000);
            } catch (err) {
                alert('ë§í¬: ' + link);
            }
        });

        document.getElementById('shareModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('shareModal')) {
                document.getElementById('shareModal').classList.remove('active');
            }
        });

        // íŒ€ì› ê³µìœ  ëª¨ë‹¬
        document.getElementById('closeTeamShareModal').addEventListener('click', () => {
            document.getElementById('teamShareModal').classList.remove('active');
        });

        document.getElementById('copyTeamBtn').addEventListener('click', async () => {
            const link = document.getElementById('teamShareLink').value;
            try {
                await navigator.clipboard.writeText(link);
                document.getElementById('teamCopyMessage').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('teamCopyMessage').classList.add('hidden');
                }, 3000);
            } catch (err) {
                alert('ë§í¬: ' + link);
            }
        });

        document.getElementById('teamShareModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('teamShareModal')) {
                document.getElementById('teamShareModal').classList.remove('active');
            }
        });

        loadFromGoogleSheets();
    </script>
</body>
</html>
