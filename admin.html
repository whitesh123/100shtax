<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í• ì¼ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .circular-progress {
            transform: rotate(-90deg);
            filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.3));
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .share-modal.active {
            display: flex;
        }

        .share-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            z-index: 999;
            display: none;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .sync-status.syncing {
            display: flex;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }

        .sync-status.success {
            display: flex;
            background: linear-gradient(135deg, #10b981, #22c55e);
            color: white;
        }

        .sync-status.error {
            display: flex;
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
        }

        /* ë¡œê·¸ì¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        #loginPage {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            max-width: 420px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
        }

        .password-input-wrapper {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 20px;
            user-select: none;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 640px) {
            .share-modal-content {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem !important;
            }
            
            .text-5xl {
                font-size: 2rem !important;
            }
            
            .text-2xl {
                font-size: 1.5rem !important;
            }

            .login-box {
                padding: 30px 20px;
                margin: 20px;
            }
        }

        #mainContent {
            display: none;
        }

        #mainContent.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 p-4 sm:p-8">
    
    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
    <div id="loginPage">
        <div class="login-box">
            <div class="text-center mb-8">
                <div class="inline-block bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-transparent bg-clip-text">
                    <h1 class="text-4xl font-bold mb-2">ğŸ” ë¡œê·¸ì¸</h1>
                </div>
                <p class="text-gray-600 text-sm">í• ì¼ ê´€ë¦¬ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</p>
            </div>

            <div id="loginError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm text-center">
                ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <div class="password-input-wrapper">
                        <input 
                            type="password" 
                            id="passwordInput"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition pr-12"
                            required
                        >
                        <span class="toggle-password" onclick="togglePasswordVisibility()">ğŸ‘ï¸</span>
                    </div>
                </div>

                <button 
                    type="submit"
                    class="w-full py-3 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white font-bold rounded-xl hover:shadow-lg transform hover:scale-105 transition">
                    ë¡œê·¸ì¸
                </button>
            </form>

            <div class="mt-6 text-center text-sm text-gray-500">
                <p>ğŸ’¡ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: <code class="bg-gray-100 px-2 py-1 rounded">admin1234</code></p>
                <p class="mt-2 text-xs">ì½”ë“œì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
    <div id="mainContent">
        <div id="syncStatus" class="sync-status"></div>

        <div class="max-w-5xl mx-auto">
            <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì¶”ê°€ -->
            <div class="flex justify-end mb-4">
                <button 
                    onclick="handleLogout()"
                    class="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition font-medium shadow-lg">
                    <span>ğŸšª</span>
                    <span>ë¡œê·¸ì•„ì›ƒ</span>
                </button>
            </div>

            <div class="text-center mb-6 sm:mb-8 animate-fade-in">
                <div class="inline-block bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-transparent bg-clip-text">
                    <h1 class="text-3xl sm:text-5xl font-bold mb-2">âœ¨ í• ì¼ ê´€ë¦¬</h1>
                </div>
                <p class="text-gray-600 text-xs sm:text-sm">ë‹¹ì‹ ì˜ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”</p>
            </div>

            <div class="glass-effect rounded-3xl shadow-2xl p-4 sm:p-8 mb-6 animate-fade-in">
                <div class="mb-6 sm:mb-10 p-4 sm:p-8 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-2xl text-white shadow-xl">
                    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div class="text-center sm:text-left">
                            <h2 class="text-xl sm:text-2xl font-bold mb-2 sm:mb-3">ì „ì²´ ì§„ì²™ë„</h2>
                            <p class="text-sm sm:text-lg opacity-90" id="totalProgressText">0ê°œì˜ í• ì¼ ì¤‘ 0ê°œ ì™„ë£Œ</p>
                        </div>
                        <div id="totalProgressCircle" class="transform hover:scale-110 transition-transform"></div>
                    </div>
                </div>

                <!-- ê²€ìƒ‰ ê¸°ëŠ¥ -->
                <div class="mb-6 sm:mb-8">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="ğŸ” í• ì¼ ê²€ìƒ‰..." 
                            class="w-full px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition text-base sm:text-lg font-medium pr-24">
                        <button id="clearSearch" class="hidden absolute right-2 top-1/2 transform -translate-y-1/2 px-4 py-2 text-gray-500 hover:text-gray-700 transition">
                            âœ•
                        </button>
                    </div>
                    <div id="searchResults" class="hidden mt-2 text-sm text-gray-600">
                        <span id="searchCount"></span>
                    </div>
                </div>

                <div class="mb-6 sm:mb-8">
                    <button id="archiveToggle" class="w-full sm:w-auto flex items-center justify-center gap-3 px-4 sm:px-6 py-3 rounded-xl transition font-medium shadow-lg bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 hover:from-purple-200 hover:to-pink-200 transform hover:scale-105">
                        <span class="text-xl">ğŸ“¦</span>
                        <span class="text-sm sm:text-base">ê³¼ê±° ì™„ë£Œì‘ì—… ë³´ê¸° (<span id="archiveCount">0</span>)</span>
                    </button>
                </div>

                <div id="archiveSection" class="mb-6 sm:mb-8 p-4 sm:p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl hidden border-2 border-purple-200">
                    <h3 class="text-lg sm:text-xl font-bold text-purple-800 mb-4 flex items-center gap-2">
                        <span>ğŸ“¦</span> ê³¼ê±° ì™„ë£Œì‘ì—…
                    </h3>
                    <div id="archiveList"></div>
                </div>

                <div class="mb-6 sm:mb-10 space-y-4 sm:space-y-5 p-4 sm:p-6 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl">
                    <input type="text" id="titleInput" placeholder="âœ¨ ìƒˆë¡œìš´ í• ì¼ì„ ì¶”ê°€í•˜ì„¸ìš”..." 
                        class="w-full px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition text-base sm:text-lg font-medium">
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <input type="date" id="dateInput" 
                            class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition font-medium text-sm sm:text-base">
                        <input type="date" id="deadlineInput" 
                            class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-100 transition font-medium text-sm sm:text-base"
                            placeholder="ë§ˆê°ì¼ (ì„ íƒ)">
                    </div>

                    <select id="priorityInput" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition font-medium text-sm sm:text-base">
                        <option value="ë‚®ìŒ">ğŸŸ¢ ë‚®ì€ ìš°ì„ ìˆœìœ„</option>
                        <option value="ë³´í†µ" selected>ğŸŸ¡ ë³´í†µ ìš°ì„ ìˆœìœ„</option>
                        <option value="ë†’ìŒ">ğŸ”´ ë†’ì€ ìš°ì„ ìˆœìœ„</option>
                    </select>

                    <input type="text" id="categoryInput" placeholder="ğŸ“ ì¹´í…Œê³ ë¦¬ (ì˜ˆ: ì—…ë¬´, ê°œì¸, í•™ìŠµ)" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition font-medium text-sm sm:text-base">

                    <textarea id="descriptionInput" placeholder="ğŸ“ ì„¤ëª… (ì„ íƒì‚¬í•­)" rows="3"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition font-medium resize-none text-sm sm:text-base"></textarea>

                    <button id="addBtn" 
                        class="w-full py-3 sm:py-4 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white font-bold rounded-xl hover:shadow-2xl transform hover:scale-105 transition text-base sm:text-lg">
                        â• í• ì¼ ì¶”ê°€
                    </button>
                </div>

                <div class="mb-6 flex flex-wrap gap-2">
                    <button onclick="filterByPriority('ì „ì²´')" class="filter-btn px-4 py-2 rounded-lg font-medium transition bg-indigo-600 text-white">
                        ì „ì²´
                    </button>
                    <button onclick="filterByPriority('ë†’ìŒ')" class="filter-btn px-4 py-2 rounded-lg font-medium transition bg-gray-200 text-gray-700 hover:bg-gray-300">
                        ğŸ”´ ë†’ìŒ
                    </button>
                    <button onclick="filterByPriority('ë³´í†µ')" class="filter-btn px-4 py-2 rounded-lg font-medium transition bg-gray-200 text-gray-700 hover:bg-gray-300">
                        ğŸŸ¡ ë³´í†µ
                    </button>
                    <button onclick="filterByPriority('ë‚®ìŒ')" class="filter-btn px-4 py-2 rounded-lg font-medium transition bg-gray-200 text-gray-700 hover:bg-gray-300">
                        ğŸŸ¢ ë‚®ìŒ
                    </button>
                </div>

                <div id="todoList" class="space-y-4 sm:space-y-5"></div>
            </div>
        </div>
    </div>

    <!-- ê³ ê° ê³µìœ  ëª¨ë‹¬ -->
    <div id="shareModal" class="share-modal">
        <div class="share-modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-indigo-600">ğŸ”— ê³ ê° ê³µìœ  ë§í¬</h3>
                <button id="closeShareModal" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">âœ•</button>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ê³µìœ  ë§í¬</label>
                <div class="flex gap-2">
                    <input type="text" id="shareLink" readonly 
                        class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg bg-gray-50 font-mono text-sm">
                    <button id="copyBtn" 
                        class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
                        ë³µì‚¬
                    </button>
                </div>
                <p id="copyMessage" class="hidden mt-2 text-green-600 font-medium text-sm">âœ“ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-blue-800">
                    <strong>ğŸ“Œ ì•ˆë‚´:</strong> ì´ ë§í¬ë¥¼ ê³ ê°ì—ê²Œ ì „ë‹¬í•˜ë©´, ê³ ê°ì€ í• ì¼ì˜ ì§„í–‰ ìƒí™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>

            <div id="sharePreview" class="border-2 border-gray-200 rounded-lg p-4 bg-gray-50">
                <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© -->
            </div>
        </div>
    </div>

    <!-- íŒ€ì› ê³µìœ  ëª¨ë‹¬ -->
    <div id="teamShareModal" class="share-modal">
        <div class="share-modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-purple-600">ğŸ‘¥ íŒ€ì› ê³µìœ  ë§í¬</h3>
                <button id="closeTeamShareModal" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">âœ•</button>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">ê³µìœ  ë§í¬</label>
                <div class="flex gap-2">
                    <input type="text" id="teamShareLink" readonly 
                        class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg bg-gray-50 font-mono text-sm">
                    <button id="copyTeamBtn" 
                        class="px-6 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition">
                        ë³µì‚¬
                    </button>
                </div>
                <p id="teamCopyMessage" class="hidden mt-2 text-green-600 font-medium text-sm">âœ“ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            </div>

            <div class="bg-purple-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-purple-800">
                    <strong>ğŸ“Œ ì•ˆë‚´:</strong> ì´ ë§í¬ë¥¼ íŒ€ì›ì—ê²Œ ì „ë‹¬í•˜ë©´, íŒ€ì›ë„ í• ì¼ì„ ì¶”ê°€í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>

            <div id="teamSharePreview" class="border-2 border-gray-200 rounded-lg p-4 bg-gray-50">
                <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© -->
            </div>
        </div>
    </div>

    <script>
        // ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ì—¬ê¸°ì„œ ë³€ê²½ ê°€ëŠ¥)
        const ADMIN_PASSWORD = '18133505';
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            
            if (isLoggedIn) {
                showMainContent();
            } else {
                showLoginPage();
            }
        }

        // ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainContent').classList.remove('active');
        }

        // ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
        function showMainContent() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainContent').classList.add('active');
        }

        // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function togglePasswordVisibility() {
            const input = document.getElementById('passwordInput');
            const toggle = document.querySelector('.toggle-password');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.textContent = 'ğŸ™ˆ';
            } else {
                input.type = 'password';
                toggle.textContent = 'ğŸ‘ï¸';
            }
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin(event) {
            event.preventDefault();
            
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === ADMIN_PASSWORD) {
                // ë¡œê·¸ì¸ ì„±ê³µ
                localStorage.setItem('isLoggedIn', 'true');
                errorDiv.classList.add('hidden');
                showMainContent();
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('passwordInput').value = '';
            } else {
                // ë¡œê·¸ì¸ ì‹¤íŒ¨
                errorDiv.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                
                // 3ì´ˆ í›„ ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¹€
                setTimeout(() => {
                    errorDiv.classList.add('hidden');
                }, 3000);
            }
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('isLoggedIn');
                showLoginPage();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        window.addEventListener('DOMContentLoaded', checkLoginStatus);

        // === ê¸°ì¡´ í• ì¼ ê´€ë¦¬ ì½”ë“œ ===
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        let expandedTodos = new Set();
        let currentFilter = 'ì „ì²´';
        let searchQuery = '';
        let showArchive = false;

        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        function addTodo() {
            const title = document.getElementById('titleInput').value.trim();
            const date = document.getElementById('dateInput').value;
            const deadline = document.getElementById('deadlineInput').value;
            const priority = document.getElementById('priorityInput').value;
            const category = document.getElementById('categoryInput').value.trim();
            const description = document.getElementById('descriptionInput').value.trim();

            if (!title) {
                alert('í• ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const todo = {
                id: Date.now(),
                title,
                date,
                deadline,
                priority,
                category,
                description,
                completed: false,
                subtasks: [],
                createdAt: new Date().toISOString(),
                archived: false
            };

            todos.unshift(todo);
            saveTodos();
            
            document.getElementById('titleInput').value = '';
            document.getElementById('dateInput').value = '';
            document.getElementById('deadlineInput').value = '';
            document.getElementById('priorityInput').value = 'ë³´í†µ';
            document.getElementById('categoryInput').value = '';
            document.getElementById('descriptionInput').value = '';
            
            render();
            saveToGoogleSheets();
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                if (todo.completed) {
                    todo.completedAt = new Date().toISOString();
                } else {
                    delete todo.completedAt;
                }
                saveTodos();
                render();
                saveToGoogleSheets();
            }
        }

        function deleteTodo(id) {
            if (confirm('ì´ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todos = todos.filter(t => t.id !== id);
                saveTodos();
                render();
                saveToGoogleSheets();
            }
        }

        function addSubtask(todoId, input) {
            const title = input.value.trim();
            if (!title) return;

            const todo = todos.find(t => t.id === todoId);
            if (todo) {
                if (!todo.subtasks) todo.subtasks = [];
                todo.subtasks.push({
                    id: Date.now(),
                    title,
                    completed: false
                });
                saveTodos();
                input.value = '';
                render();
                saveToGoogleSheets();
            }
        }

        function toggleSubtask(todoId, subtaskId) {
            const todo = todos.find(t => t.id === todoId);
            if (todo && todo.subtasks) {
                const subtask = todo.subtasks.find(s => s.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    saveTodos();
                    render();
                    saveToGoogleSheets();
                }
            }
        }

        function deleteSubtask(todoId, subtaskId) {
            const todo = todos.find(t => t.id === todoId);
            if (todo && todo.subtasks) {
                todo.subtasks = todo.subtasks.filter(s => s.id !== subtaskId);
                saveTodos();
                render();
                saveToGoogleSheets();
            }
        }

        function toggleExpand(id) {
            if (expandedTodos.has(id)) {
                expandedTodos.delete(id);
            } else {
                expandedTodos.add(id);
            }
            render();
        }

        function filterByPriority(priority) {
            currentFilter = priority;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-indigo-600', 'text-white');
            
            render();
        }

        function archiveTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo && todo.completed) {
                todo.archived = true;
                todo.archivedAt = new Date().toISOString();
                saveTodos();
                render();
                saveToGoogleSheets();
            }
        }

        function unarchiveTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.archived = false;
                delete todo.archivedAt;
                saveTodos();
                render();
                saveToGoogleSheets();
            }
        }

        function duplicateTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                const newTodo = {
                    ...todo,
                    id: Date.now(),
                    completed: false,
                    createdAt: new Date().toISOString(),
                    title: todo.title + ' (ë³µì‚¬ë³¸)',
                    subtasks: todo.subtasks ? todo.subtasks.map(st => ({...st, id: Date.now() + Math.random(), completed: false})) : []
                };
                delete newTodo.completedAt;
                delete newTodo.archivedAt;
                newTodo.archived = false;
                
                todos.unshift(newTodo);
                saveTodos();
                render();
                saveToGoogleSheets();
            }
        }

        function openShareModal(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;

            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?view=${todo.id}`;
            
            document.getElementById('shareLink').value = shareUrl;
            document.getElementById('shareModal').classList.add('active');
            
            const preview = document.getElementById('sharePreview');
            const progress = calculateProgress(todo);
            preview.innerHTML = `
                <h4 class="font-bold text-lg mb-2">${todo.title}</h4>
                <div class="text-sm text-gray-600 space-y-1">
                    <p>ğŸ“… ${todo.date || 'ë‚ ì§œ ë¯¸ì •'}</p>
                    <p>â° ë§ˆê°: ${todo.deadline || 'ì—†ìŒ'}</p>
                    <p>ğŸ“Š ì§„í–‰ë¥ : ${progress}%</p>
                    ${todo.category ? `<p>ğŸ“ ${todo.category}</p>` : ''}
                </div>
            `;
        }

        function openTeamShareModal(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;

            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?edit=${todo.id}`;
            
            document.getElementById('teamShareLink').value = shareUrl;
            document.getElementById('teamShareModal').classList.add('active');
            
            const preview = document.getElementById('teamSharePreview');
            const progress = calculateProgress(todo);
            preview.innerHTML = `
                <h4 class="font-bold text-lg mb-2">${todo.title}</h4>
                <div class="text-sm text-gray-600 space-y-1">
                    <p>ğŸ“… ${todo.date || 'ë‚ ì§œ ë¯¸ì •'}</p>
                    <p>â° ë§ˆê°: ${todo.deadline || 'ì—†ìŒ'}</p>
                    <p>ğŸ“Š ì§„í–‰ë¥ : ${progress}%</p>
                    ${todo.category ? `<p>ğŸ“ ${todo.category}</p>` : ''}
                </div>
            `;
        }

        function addToCalendar(todo) {
            const startDate = todo.date || todo.deadline;
            if (!startDate) {
                alert('ë‚ ì§œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const title = encodeURIComponent(todo.title);
            const description = encodeURIComponent(todo.description || '');
            const start = startDate.replace(/-/g, '');
            const end = (todo.deadline || startDate).replace(/-/g, '');

            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${start}/${end}&details=${description}`;
            
            window.open(googleCalendarUrl, '_blank');
        }

        function calculateProgress(todo) {
            if (!todo.subtasks || todo.subtasks.length === 0) {
                return todo.completed ? 100 : 0;
            }
            
            const completed = todo.subtasks.filter(st => st.completed).length;
            return Math.round((completed / todo.subtasks.length) * 100);
        }

        function createProgressCircle(percentage, size = 80) {
            const radius = (size - 8) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;

            return `
                <svg width="${size}" height="${size}" class="circular-progress">
                    <circle cx="${size/2}" cy="${size/2}" r="${radius}" 
                        fill="none" stroke="#e5e7eb" stroke-width="6"/>
                    <circle cx="${size/2}" cy="${size/2}" r="${radius}" 
                        fill="none" stroke="url(#gradient)" stroke-width="6"
                        stroke-dasharray="${circumference}" 
                        stroke-dashoffset="${offset}"
                        stroke-linecap="round"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#8b5cf6"/>
                            <stop offset="100%" style="stop-color:#ec4899"/>
                        </linearGradient>
                    </defs>
                    <text x="50%" y="50%" text-anchor="middle" dy=".3em" 
                        class="text-2xl font-bold fill-white">
                        ${percentage}%
                    </text>
                </svg>
            `;
        }

        function showSyncStatus(status, message) {
            const statusEl = document.getElementById('syncStatus');
            statusEl.className = `sync-status ${status}`;
            statusEl.textContent = message;

            if (status === 'success' || status === 'error') {
                setTimeout(() => {
                    statusEl.classList.remove(status);
                }, 3000);
            }
        }

        async function saveToGoogleSheets() {
            showSyncStatus('syncing', 'ğŸ”„ ë™ê¸°í™” ì¤‘...');
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            showSyncStatus('success', 'âœ“ ì €ì¥ ì™„ë£Œ');
        }

        async function loadFromGoogleSheets() {
            showSyncStatus('syncing', 'ğŸ”„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            
            await new Promise(resolve => setTimeout(resolve, 800));
            
            showSyncStatus('success', 'âœ“ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
        }

        function render() {
            const activeTodos = todos.filter(t => !t.archived);
            const archivedTodos = todos.filter(t => t.archived);
            
            let filteredTodos = activeTodos;
            
            if (currentFilter !== 'ì „ì²´') {
                filteredTodos = filteredTodos.filter(t => t.priority === currentFilter);
            }
            
            if (searchQuery) {
                filteredTodos = filteredTodos.filter(t => 
                    t.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (t.description && t.description.toLowerCase().includes(searchQuery.toLowerCase())) ||
                    (t.category && t.category.toLowerCase().includes(searchQuery.toLowerCase()))
                );
                
                document.getElementById('searchResults').classList.remove('hidden');
                document.getElementById('searchCount').textContent = `${filteredTodos.length}ê°œì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
            } else {
                document.getElementById('searchResults').classList.add('hidden');
            }

            const totalTodos = activeTodos.length;
            const completedTodos = activeTodos.filter(t => t.completed).length;
            const totalProgress = totalTodos > 0 ? Math.round((completedTodos / totalTodos) * 100) : 0;

            document.getElementById('totalProgressText').textContent = `${totalTodos}ê°œì˜ í• ì¼ ì¤‘ ${completedTodos}ê°œ ì™„ë£Œ`;
            document.getElementById('totalProgressCircle').innerHTML = createProgressCircle(totalProgress, 100);

            document.getElementById('archiveCount').textContent = archivedTodos.length;

            if (showArchive) {
                renderArchive(archivedTodos);
            }

            const todoList = document.getElementById('todoList');
            if (filteredTodos.length === 0) {
                todoList.innerHTML = `
                    <div class="text-center py-12 text-gray-400">
                        <div class="text-6xl mb-4">ğŸ“</div>
                        <p class="text-xl font-medium">${searchQuery ? 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤' : 'ì•„ì§ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤'}</p>
                        <p class="text-sm mt-2">${searchQuery ? 'ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”' : 'ìƒˆë¡œìš´ í• ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!'}</p>
                    </div>
                `;
            } else {
                todoList.innerHTML = filteredTodos.map(todo => {
                    const isExpanded = expandedTodos.has(todo.id);
                    const progress = calculateProgress(todo);
                    const priorityColors = {
                        'ë†’ìŒ': 'from-red-500 to-orange-500',
                        'ë³´í†µ': 'from-yellow-500 to-amber-500',
                        'ë‚®ìŒ': 'from-green-500 to-emerald-500'
                    };

                    const isOverdue = todo.deadline && new Date(todo.deadline) < new Date() && !todo.completed;

                    return `
                        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 overflow-hidden animate-fade-in border-2 ${isOverdue ? 'border-red-300' : 'border-gray-100'}">
                            <div class="p-4 sm:p-5">
                                <div class="flex items-start gap-3 sm:gap-4">
                                    <button onclick="toggleTodo(${todo.id})" 
                                        class="flex-shrink-0 mt-1 w-6 h-6 sm:w-7 sm:h-7 rounded-xl border-3 flex items-center justify-center transition transform hover:scale-110 ${
                                            todo.completed ? 'bg-gradient-to-br from-indigo-500 to-purple-600 border-indigo-600' : 'border-gray-300 hover:border-indigo-500 bg-white'
                                        }">
                                        ${todo.completed ? '<span class="text-white text-sm font-bold">âœ“</span>' : ''}
                                    </button>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-start justify-between gap-3 mb-2">
                                            <h3 class="text-lg sm:text-xl font-bold break-words ${todo.completed ? 'line-through text-gray-400' : 'text-gray-800'}">
                                                ${todo.title}
                                            </h3>
                                            <span class="flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold bg-gradient-to-r ${priorityColors[todo.priority]} text-white shadow-md">
                                                ${todo.priority}
                                            </span>
                                        </div>

                                        ${todo.description ? `
                                            <p class="text-sm text-gray-600 mb-3 break-words">${todo.description}</p>
                                        ` : ''}

                                        <div class="flex flex-wrap gap-2 text-xs sm:text-sm text-gray-600 mb-3">
                                            ${todo.date ? `<span class="flex items-center gap-1 px-2 py-1 bg-blue-50 rounded-lg">ğŸ“… ${todo.date}</span>` : ''}
                                            ${todo.deadline ? `<span class="flex items-center gap-1 px-2 py-1 ${isOverdue ? 'bg-red-100 text-red-700 font-bold' : 'bg-pink-50'} rounded-lg">â° ${todo.deadline} ${isOverdue ? '(ê¸°í•œ ì´ˆê³¼!)' : ''}</span>` : ''}
                                            ${todo.category ? `<span class="flex items-center gap-1 px-2 py-1 bg-purple-50 rounded-lg">ğŸ“ ${todo.category}</span>` : ''}
                                        </div>

                                        <div class="mb-3">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="text-xs font-medium text-gray-600">ì§„í–‰ë¥ </span>
                                                <span class="text-xs font-bold text-indigo-600">${progress}%</span>
                                            </div>
                                            <div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                                                <div class="h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-500 rounded-full" 
                                                    style="width: ${progress}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-100">
                                    <button onclick="openShareModal(${todo.id})" 
                                        class="px-3 py-2 text-xs sm:text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition font-medium" title="ê³ ê°ì—ê²Œ ê³µìœ ">
                                        ğŸ”— ê³ ê°ê³µìœ 
                                    </button>
                                    <button onclick="openTeamShareModal(${todo.id})" 
                                        class="px-3 py-2 text-xs sm:text-sm bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition font-medium" title="íŒ€ì›ê³¼ ê³µìœ ">
                                        ğŸ‘¥ íŒ€ì›ê³µìœ 
                                    </button>
                                    <button onclick="duplicateTodo(${todo.id})" 
                                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition transform hover:scale-110" title="ë³µì‚¬í•˜ê¸°">
                                        ğŸ“‹
                                    </button>
                                    ${progress === 100 ? `
                                        <button onclick="archiveTodo(${todo.id})" 
                                            class="p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition transform hover:scale-110" title="ë³´ê´€í•˜ê¸°">
                                            ğŸ“¦
                                        </button>
                                    ` : ''}
                                    ${(todo.date || todo.deadline) ? `
                                        <button onclick='addToCalendar(${JSON.stringify(todo).replace(/'/g, "&apos;")})' 
                                            class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition transform hover:scale-110" title="ìº˜ë¦°ë”ì— ì¶”ê°€">
                                            ğŸ“…
                                        </button>
                                    ` : ''}
                                    <button onclick="deleteTodo(${todo.id})" 
                                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition transform hover:scale-110" title="ì‚­ì œ">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>

                                <button onclick="toggleExpand(${todo.id})" 
                                    class="w-full mt-4 py-2 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg transition font-medium">
                                    ${isExpanded ? 'â–² ì ‘ê¸°' : todo.subtasks && todo.subtasks.length > 0 ? 'â–¼ ì„¸ë¶€ëª©ë¡ ë³´ê¸°' : 'â• ì„¸ë¶€ì‘ì—… ì¶”ê°€'}
                                </button>
                            </div>

                            ${isExpanded ? `
                                <div class="px-4 sm:px-5 pb-4 sm:pb-5 bg-gradient-to-br from-indigo-50 to-purple-50 border-t-2 border-indigo-200">
                                    <div class="pt-4 space-y-3">
                                        ${todo.subtasks && todo.subtasks.length > 0 ? todo.subtasks.map(subtask => `
                                            <div class="flex items-center gap-3 p-2 bg-white rounded-lg shadow-sm hover:shadow-md transition">
                                                <button onclick="toggleSubtask(${todo.id}, ${subtask.id})" 
                                                    class="flex-shrink-0 w-5 h-5 sm:w-6 sm:h-6 rounded-md border-2 flex items-center justify-center transition transform hover:scale-110 ${
                                                        subtask.completed ? 'bg-gradient-to-br from-indigo-400 to-purple-500 border-indigo-500' : 'border-gray-300 hover:border-indigo-500 bg-white'
                                                    }">
                                                    ${subtask.completed ? '<span class="text-white text-xs font-bold">âœ“</span>' : ''}
                                                </button>
                                                <p class="flex-1 font-medium text-sm sm:text-base break-words ${subtask.completed ? 'line-through text-gray-400' : 'text-gray-700'}">
                                                    ${subtask.title}
                                                </p>
                                                <button onclick="deleteSubtask(${todo.id}, ${subtask.id})" 
                                                    class="p-1 text-red-400 hover:text-red-600 transition transform hover:scale-125 flex-shrink-0">
                                                    ğŸ—‘ï¸
                                                </button>
                                            </div>
                                        `).join('') : '<p class="text-center text-gray-400 py-4">ì•„ì§ ì„¸ë¶€ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                                        <div class="mt-4">
                                            <input type="text" placeholder="âœ¨ ì„¸ë¶€ ëª©ë¡ ì¶”ê°€..." 
                                                onkeypress="if(event.key==='Enter') { addSubtask(${todo.id}, this); }"
                                                class="w-full px-4 py-3 font-medium border-2 border-indigo-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition text-sm sm:text-base">
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
        }

        function renderArchive(archivedTodos) {
            const archiveList = document.getElementById('archiveList');
            
            if (archivedTodos.length === 0) {
                archiveList.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <p class="text-lg">ë³´ê´€ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            } else {
                archiveList.innerHTML = archivedTodos.map(todo => `
                    <div class="bg-white rounded-xl shadow p-4 mb-3">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-700">${todo.title}</h4>
                                <p class="text-sm text-gray-500 mt-1">ì™„ë£Œì¼: ${new Date(todo.completedAt).toLocaleDateString('ko-KR')}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="unarchiveTodo(${todo.id})" 
                                    class="px-3 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-sm font-medium">
                                    ë³µì›
                                </button>
                                <button onclick="deleteTodo(${todo.id})" 
                                    class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        document.getElementById('addBtn').addEventListener('click', addTodo);
        document.getElementById('titleInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTodo();
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchQuery = e.target.value.trim();
            
            const clearBtn = document.getElementById('clearSearch');
            if (searchQuery) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            
            render();
        });

        document.getElementById('clearSearch').addEventListener('click', () => {
            searchQuery = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('clearSearch').classList.add('hidden');
            render();
        });

        document.getElementById('archiveToggle').addEventListener('click', () => {
            showArchive = !showArchive;
            const section = document.getElementById('archiveSection');
            const btn = document.getElementById('archiveToggle');
            
            if (showArchive) {
                section.classList.remove('hidden');
                btn.classList.remove('bg-gradient-to-r', 'from-purple-100', 'to-pink-100', 'text-purple-700');
                btn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'text-white');
                btn.innerHTML = '<span class="text-xl">ğŸ“¦</span> <span class="text-sm sm:text-base">ê³¼ê±° ì™„ë£Œì‘ì—… ë‹«ê¸° (<span id="archiveCount">' + 
                    todos.filter(t => t.archived).length + '</span>)</span>';
            } else {
                section.classList.add('hidden');
                btn.classList.add('bg-gradient-to-r', 'from-purple-100', 'to-pink-100', 'text-purple-700');
                btn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'text-white');
                btn.innerHTML = '<span class="text-xl">ğŸ“¦</span> <span class="text-sm sm:text-base">ê³¼ê±° ì™„ë£Œì‘ì—… ë³´ê¸° (<span id="archiveCount">' + 
                    todos.filter(t => t.archived).length + '</span>)</span>';
            }
        });

        document.getElementById('closeShareModal').addEventListener('click', () => {
            document.getElementById('shareModal').classList.remove('active');
        });

        document.getElementById('copyBtn').addEventListener('click', async () => {
            const link = document.getElementById('shareLink').value;
            try {
                await navigator.clipboard.writeText(link);
                document.getElementById('copyMessage').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('copyMessage').classList.add('hidden');
                }, 3000);
            } catch (err) {
                alert('ë§í¬: ' + link);
            }
        });

        document.getElementById('shareModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('shareModal')) {
                document.getElementById('shareModal').classList.remove('active');
            }
        });

        document.getElementById('closeTeamShareModal').addEventListener('click', () => {
            document.getElementById('teamShareModal').classList.remove('active');
        });

        document.getElementById('copyTeamBtn').addEventListener('click', async () => {
            const link = document.getElementById('teamShareLink').value;
            try {
                await navigator.clipboard.writeText(link);
                document.getElementById('teamCopyMessage').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('teamCopyMessage').classList.add('hidden');
                }, 3000);
            } catch (err) {
                alert('ë§í¬: ' + link);
            }
        });

        document.getElementById('teamShareModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('teamShareModal')) {
                document.getElementById('teamShareModal').classList.remove('active');
            }
        });

        loadFromGoogleSheets();
    </script>
</body>
</html>
