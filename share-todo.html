<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ì§„ì²™ë„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .circular-progress {
            transform: rotate(-90deg);
            filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.3));
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 p-4 sm:p-8">
    <div class="max-w-4xl mx-auto">
        <!-- í—¤ë” -->
        <div class="text-center mb-8 animate-fade-in">
            <div class="inline-block bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-transparent bg-clip-text">
                <h1 class="text-4xl font-bold mb-2">ğŸ“Š í”„ë¡œì íŠ¸ ì§„ì²™ë„</h1>
            </div>
            <p class="text-gray-600 text-sm">ì‘ì—… ì§„í–‰ ìƒí™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <div class="glass-effect rounded-3xl shadow-2xl p-8 mb-6 animate-fade-in">
            <!-- í”„ë¡œì íŠ¸ ì œëª© -->
            <div class="mb-8 p-6 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl border-2 border-indigo-300">
                <h2 class="text-3xl font-bold text-indigo-900" id="projectTitle">í”„ë¡œì íŠ¸ ë¡œë”© ì¤‘...</h2>
            </div>

            <!-- ì „ì²´ ì§„ì²™ë„ -->
            <div class="mb-10 p-8 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-2xl text-white shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold mb-3">ì§„ì²™ë„</h3>
                        <p class="text-lg opacity-90" id="progressText">ë¡œë”© ì¤‘...</p>
                    </div>
                    <div id="progressCircle" class="transform hover:scale-110 transition-transform"></div>
                </div>
            </div>

            <!-- ìƒì„¸ ì •ë³´ -->
            <div id="projectDetails" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-10">
                <!-- ì‹œì‘ì¼ -->
                <div id="startDateSection" class="hidden p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl border-2 border-blue-200 shadow-md">
                    <p class="text-sm font-semibold text-blue-600 mb-2">ğŸ“… ì‹œì‘ì¼</p>
                    <p class="text-lg font-bold text-blue-800" id="startDate"></p>
                </div>

                <!-- ì™„ë£Œì‹œí•œ -->
                <div id="deadlineSection" class="hidden p-6 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-200 shadow-md">
                    <p class="text-sm font-semibold text-red-600 mb-2">â° ì™„ë£Œì‹œí•œ</p>
                    <p class="text-lg font-bold text-red-800" id="deadline"></p>
                </div>
            </div>

            <!-- ì„¸ë¶€ ì‘ì—… ëª©ë¡ -->
            <div id="subtasksSection" class="hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">âœ… ì„¸ë¶€ ì‘ì—…</h3>
                <div id="subtasksList" class="space-y-3 mb-8"></div>
            </div>

            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="statusMessage" class="p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200 shadow-md hidden">
                <p class="text-center text-xl font-bold text-green-800">âœ¨ ì‘ì—… ì™„ë£Œ!</p>
            </div>

            <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
            <div id="errorMessage" class="p-6 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-200 shadow-md hidden">
                <p class="text-center text-lg font-bold text-red-800">âŒ ê³µìœ ëœ ì‘ì—…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <div class="text-center text-gray-600 text-sm space-y-2 animate-fade-in">
            <p class="font-medium">ğŸ’¡ ì´ í˜ì´ì§€ëŠ” ì½ê¸° ì „ìš©ì…ë‹ˆë‹¤.</p>
            <p class="font-medium">ğŸ”„ 5ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ìµœì‹  ì •ë³´ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        let sharedTodo = null;
        let allTodos = [];

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë°ì´í„° ì¶”ì¶œ
        function getSharedTodo() {
            const params = new URLSearchParams(window.location.search);
            const data = params.get('data');
            
            if (data) {
                try {
                    sharedTodo = JSON.parse(decodeURIComponent(data));
                    return true;
                } catch (e) {
                    console.error('Failed to parse shared data:', e);
                    return false;
                }
            }
            return false;
        }

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì—…ë°ì´íŠ¸ëœ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function updateFromLocalStorage() {
            const saved = localStorage.getItem('todos');
            if (saved) {
                allTodos = JSON.parse(saved);
                // shareIdë¡œ ìµœì‹  ì •ë³´ ì°¾ê¸°
                if (sharedTodo) {
                    const updated = allTodos.find(t => t.shareId === sharedTodo.shareId);
                    if (updated) {
                        sharedTodo = updated;
                    }
                }
            }
        }

        // ì§„ì²™ë„ ê³„ì‚°
        function getProgress(todo) {
            if (!todo || !todo.subtasks) return 0;
            if (todo.subtasks.length === 0) {
                return todo.completed ? 100 : 0;
            }
            const completed = todo.subtasks.filter(st => st.completed).length;
            return Math.round((completed / todo.subtasks.length) * 100);
        }

        // ì›í˜• ì§„ì²™ë„ ìƒì„±
        function createCircularProgress(percentage, size = 100) {
            const radius = (size - 16) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            
            let gradientId = `gradient-${Math.random().toString(36).substr(2, 9)}`;
            let color1, color2;
            
            if (percentage < 30) {
                color1 = '#ef4444'; color2 = '#f97316';
            } else if (percentage < 70) {
                color1 = '#f59e0b'; color2 = '#eab308';
            } else if (percentage < 100) {
                color1 = '#22c55e'; color2 = '#10b981';
            } else {
                color1 = '#8b5cf6'; color2 = '#ec4899';
            }

            return `
                <div class="relative" style="width: ${size}px; height: ${size}px;">
                    <svg width="${size}" height="${size}" class="circular-progress">
                        <defs>
                            <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:${color1};stop-opacity:1" />
                                <stop offset="100%" style="stop-color:${color2};stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle cx="${size/2}" cy="${size/2}" r="${radius}" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                        <circle cx="${size/2}" cy="${size/2}" r="${radius}" fill="none" stroke="url(#${gradientId})" stroke-width="8" 
                            stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" stroke-linecap="round" 
                            style="transition: stroke-dashoffset 0.8s ease-in-out;"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-3xl font-bold bg-gradient-to-br from-indigo-600 to-purple-600 text-transparent bg-clip-text">${percentage}%</span>
                    </div>
                </div>
            `;
        }

        // ë Œë”ë§
        function render() {
            if (!sharedTodo) {
                document.getElementById('errorMessage').classList.remove('hidden');
                return;
            }

            document.getElementById('errorMessage').classList.add('hidden');
            
            const progress = getProgress(sharedTodo);

            // ì œëª©
            document.getElementById('projectTitle').textContent = sharedTodo.title;

            // ì§„ì²™ë„
            document.getElementById('progressText').textContent = sharedTodo.completed ? 'âœ¨ ì™„ë£Œë¨!' : `ì§„í–‰ ì¤‘... ${progress}%`;
            document.getElementById('progressCircle').innerHTML = createCircularProgress(progress, 100);

            // ì‹œì‘ì¼
            if (sharedTodo.date) {
                const startDate = new Date(sharedTodo.date + 'T00:00');
                document.getElementById('startDate').textContent = startDate.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'short'
                }) + (sharedTodo.time ? ` ${sharedTodo.time}` : '');
                document.getElementById('startDateSection').classList.remove('hidden');
            } else {
                document.getElementById('startDateSection').classList.add('hidden');
            }

            // ì™„ë£Œì‹œí•œ
            if (sharedTodo.deadline) {
                const isOverdue = new Date(sharedTodo.deadline + 'T' + (sharedTodo.deadlineTime || '23:59')) < new Date() && !sharedTodo.completed;
                const deadline = new Date(sharedTodo.deadline + 'T00:00');
                const deadlineText = deadline.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'short'
                }) + (sharedTodo.deadlineTime ? ` ${sharedTodo.deadlineTime}` : '');
                
                document.getElementById('deadline').textContent = deadlineText + (isOverdue ? ' âš ï¸ (ê¸°í•œ ì´ˆê³¼)' : '');
                const deadlineSection = document.getElementById('deadlineSection');
                deadlineSection.classList.remove('hidden');
                
                if (isOverdue) {
                    deadlineSection.classList.remove('from-red-50', 'to-red-100', 'border-red-200');
                    deadlineSection.classList.add('from-orange-100', 'to-red-200', 'border-orange-400', 'bg-orange-50');
                }
            } else {
                document.getElementById('deadlineSection').classList.add('hidden');
            }

            // ì„¸ë¶€ ì‘ì—…
            if (sharedTodo.subtasks && sharedTodo.subtasks.length > 0) {
                document.getElementById('subtasksSection').classList.remove('hidden');
                document.getElementById('subtasksList').innerHTML = sharedTodo.subtasks.map(subtask => `
                    <div class="flex items-center gap-4 p-4 bg-white rounded-xl shadow-md hover:shadow-lg transition">
                        <div class="flex-shrink-0 w-6 h-6 rounded-md flex items-center justify-center ${
                            subtask.completed ? 'bg-green-500' : 'bg-gray-300'
                        }">
                            ${subtask.completed ? '<span class="text-white text-sm font-bold">âœ“</span>' : ''}
                        </div>
                        <p class="flex-1 font-medium text-lg ${subtask.completed ? 'line-through text-gray-400' : 'text-gray-800'}">
                            ${subtask.title}
                        </p>
                        <span class="text-2xl">${subtask.completed ? 'âœ…' : 'â³'}</span>
                    </div>
                `).join('');
            } else {
                document.getElementById('subtasksSection').classList.add('hidden');
            }

            // ì™„ë£Œ ìƒíƒœ
            if (progress === 100 && sharedTodo.completed) {
                document.getElementById('statusMessage').classList.remove('hidden');
            } else {
                document.getElementById('statusMessage').classList.add('hidden');
            }
        }

        // 5ì´ˆë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨
        setInterval(() => {
            updateFromLocalStorage();
            render();
        }, 5000);

        // ì´ˆê¸° ë¡œë“œ
        if (getSharedTodo()) {
            updateFromLocalStorage();
            render();
        } else {
            document.getElementById('errorMessage').classList.remove('hidden');
        }
    </script>
</body>
</html>
